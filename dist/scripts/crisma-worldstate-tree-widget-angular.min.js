angular.module("de.cismet.crisma.widgets.worldstateTreeWidget",["de.cismet.crisma.widgets.worldstateTreeWidget.directives","de.cismet.crisma.widgets.worldstateTreeWidget.controllers"]),angular.module("de.cismet.crisma.widgets.worldstateTreeWidget.controllers",["de.cismet.cids.rest.collidngNames.Nodes"]).controller("MainCtrl",["$scope","de.cismet.collidingNameService.Nodes",function(a,b){"use strict";a.activeItem={},a.isWorldstateIcon=!1,a.treeOptions={checkboxClass:"glyphicon glyphicon-unchecked",folderIconClosed:"icon-folder-close.png",folderIconOpen:"icon-folder-open.png",leafIcon:"icon-file.png",imagePath:"./images/",multiSelection:!0},a.switchIcon=function(){a.isWorldstateIcon?(a.treeOptions.folderIconClosed="icon-folder-close.png",a.treeOptions.folderIconOpen="icon-folder-open.png",a.treeOptions.leafIcon="icon-file.png"):(a.treeOptions.folderIconClosed="icon-world.png",a.treeOptions.folderIconOpen="icon-world.png",a.treeOptions.leafIcon="icon-world.png"),a.isWorldstateIcon=!a.isWorldstateIcon},a.switchTreeMode=function(){a.treeOptions.multiSelection=!a.treeOptions.multiSelection},a.treeSelection=[],b.query(function(b){a.nodes=b})}]),angular.module("de.cismet.crisma.widgets.worldstateTreeWidget.directives",["de.cismet.commons.angular.angularTools"]).directive("catalogueTree",["de.cismet.commons.angular.angularTools.AngularTools",function(a){"use strict";return{templateUrl:"templates/catalogue-tree.html",restrict:"E",link:function(b,c){var d,e,f,g,h=[],i=!1,j={container:"dynatree-container",node:"dynatree-node",folder:"dynatree-folder",empty:"dynatree-empty",vline:"dynatree-vline",expander:"dynatree-expander",connector:"dynatree-connector",checkbox:"dynatree-checkbox",nodeIcon:"dynatree-icon",title:"dynatree-title",noConnector:"dynatree-no-connector",nodeError:"dynatree-statusnode-error",nodeWait:"dynatree-statusnode-wait",hidden:"dynatree-hidden",combinedExpanderPrefix:"dynatree-exp-",combinedIconPrefix:"dynatree-ico-",hasChildren:"dynatree-has-children",active:"dynatree-active",selected:"dynatree-selected",expanded:"dynatree-expanded",lazy:"dynatree-lazy",focused:"dynatree-focused",partsel:"dynatree-partsel",lastsib:"dynatree-lastsib"},k=function(){var a,b={};for(a in j)j.hasOwnProperty(a)&&(b[a]=j[a]);return b},l=function(a,c){var d;return d=a?b.options.leafIcon||"":c?b.options.folderIconOpen||"":b.options.folderIconClosed||""},m=function(a){var b,c;return b=l(a.isLeaf,!1,a),c={title:a.name,isFolder:!a.isLeaf,isLazy:!a.isLeaf,cidsNode:a,icon:b}},n=function(a,b){var d,f,g,h,i,j,l,m=k();a?(g=!0,d=function(a,b){"title"===a.getEventTargetType(b)&&a.toggleSelect()},f=function(a,b){return 32===b.which?(a.toggleSelect(),!1):void 0}):(h=1,m.selected="tree-select",i=!1,j=function(a,b){var c,d;if("expander"===a.getEventTargetType(b)&&a.expand(!a.isExpanded()),"checkbox"===a.getEventTargetType(b))return!0;if(!b.ctrlKey)for(d=a.tree.getSelectedNodes(),c=0;c<d.length;c++)d[c].select(!1);return a.activate(),a.toggleSelect(),!1},d=function(a,b){return"title"===a.getEventTargetType(b)?(a.expand(!a.isExpanded()),!1):void 0},l=function(a){var b,d,e=c.dynatree("getTree"),f=e.getSelectedNodes(!1);for(b=0;b<f.length;b++)d=f[b],d.toggleSelect();return a.activate(),a.select(!0),!0}),b?(c.dynatree("option","checkbox",g||!1),c.dynatree("option","onDblClick",d||null),c.dynatree("option","onClick",j||null),c.dynatree("option","onFocus",l||null),c.dynatree("option","onKeydown",f||null),c.dynatree("option","clickFolderMode",h||3),c.dynatree("option","classNames",m),c.dynatree("option","autoFocus",i||!0)):(e.checkbox=g||!1,e.onDblClick=d||null,e.onKeydown=f||null,e.clickFolderMode=h||3,e.classNames=m,e.autoFocus=i||!0,e.onClick=j||null,e.onFocus=l||null)};if(f=b.$watchCollection("nodes",function(a,d){var e,f,h,i,j,k;if(a!==d)for(b.selectedNodes&&b.selectedNodes.length>0&&(g=!0),b.activeNode=void 0,h=c.dynatree("getRoot"),h.removeChildren(),e=0;e<a.length;e++)if(i=a[e],j=m(i),k=h.addChild(j),g)for(f=0;e<b.selectedNodes.length;f++)if(b.selectedNodes[f].key===j.cidsNode.key){k.toggleSelect();break}}),b.$watch("selectedNodes",function(){var a,c,d;if(d=[],b.selectedNodes)for(a=0;a<b.selectedNodes.length;a++)c=b.selectedNodes[a],d[c.key]?console.error("The worldstate "+c.key+" is contained multiple times in the selectedNodes property bound to the worldstateTreeWidget. Multiple items are ignored by the worldstateTreeWidget but should be avoided"):d[c.key]=c}),b.$watch("options",function(a,d){var e,f,g,h,j,k=!1;if(i){for(h in b.options)if(e=a[h],f=d[h],g=e!==f,j=e&&!f,g||j)switch(h){case"checkboxClass":c.dynatree("option","classNames.checkbox",e);break;case"checkboxEnabled":c.dynatree("option","checkbox",e);break;case"imagePath":c.dynatree("option","imagePath",e);break;case"multiSelection":n(e,!0);break;case"folderIconClosed":k=!0;break;case"folderIconOpen":k=!0;break;case"leafIcon":k=!0}}else i=!0;c.dynatree("getRoot").visit(function(a){k&&(a.data.icon=l(a.data.cidsNode.isLeaf,a.isExpanded(),a.data.cidsNode)),a.render()},!1)},!0),e={selectMode:2,children:h,classNames:j,onActivate:function(c){b.activeNode=c.data.cidsNode,a.safeApply(b)},onSelect:function(c,d){var e,f;return f=d.data.cidsNode,c?-1===b.selectedNodes.indexOf(f)&&b.selectedNodes.push(f):(e=b.selectedNodes.indexOf(f),e>=0&&b.selectedNodes.splice(e,1)),a.safeApply(b),!1},onExpand:function(a){return a.data.icon=l(a.data.cidsNode.isLeaf,a.isExpanded(),a.data.cidsNode),a.render(),!0},onLazyRead:function(a){var c,d,e,f;c=a.data.cidsNode,a.data.addClass="dynatree-loading",a.render(),d=function(c){var d,h;for(d=0;d<c.length;d++)if(h=c[d],e=m(h),f=a.addChild(e),g)for(var i=0;i<b.selectedNodes.length;i++)if(b.selectedNodes[i].key===e.cidsNode.key){f.toggleSelect();break}a.data.addClass="",a.setLazyNodeStatus(DTNodeStatus_Ok),a.data.icon=l(a.data.cidsNode.isLeaf,a.isExpanded(),a.data.cidsNode),a.render()},c.getChildren(d)}},b.options)for(var o in b.options)switch(d=b.options[o],o){case"checkboxClass":e.classNames.checkbox=d;break;case"checkboxEnabled":e.checkbox=d||!1;break;case"imagePath":e.imagePath=d;break;case"multiSelection":n(d)}c.dynatree(e)},replace:!0,scope:{nodes:"=",selectedNodes:"=selection",activeNode:"=?",options:"=?"}}}]),angular.module("de.cismet.crisma.widgets.worldstateTreeWidget.directives").run(["$templateCache",function(a){"use strict";a.put("templates/catalogue-tree.html",'<div id="tree">\n\n</div>')}]);